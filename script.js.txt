// script.js

// ----------------------------------------------------
// PEGA AQUI TU URL DE GOOGLE APPS SCRIPT (Entre comillas)
const URL_API = "https://script.google.com/macros/s/AKfycbyTGnoS8hevr6k7pXE16p7KtcQxYrYP0yc11yJoJyvfX8Z7pEKJ5ZYymJ--IBcoVqUB/exec"; 
// ----------------------------------------------------

async function iniciarSesion() {
    const email = document.getElementById('email').value;
    const clave = document.getElementById('clave').value;
    const btn = document.getElementById('btn-login');
    const errorMsg = document.getElementById('error-msg');

    // Efecto de cargando
    btn.disabled = true;
    btn.innerText = "Verificando...";
    errorMsg.classList.add('d-none');

    try {
        // Petición a Google
        const resp = await fetch(`${URL_API}?action=login&email=${email}&clave=${clave}`);
        const data = await resp.json();

        if (data.status === 'success') {
            cargarDashboard(data);
        } else {
            mostrarError(data.message);
        }

    } catch (error) {
        console.error(error);
        mostrarError("Error de conexión con el servidor.");
    } finally {
        btn.disabled = false;
        btn.innerText = "Ingresar";
    }
}

function mostrarError(msg) {
    const el = document.getElementById('error-msg');
    el.innerText = msg;
    el.classList.remove('d-none');
}

function cargarDashboard(usuario) {
    // Ocultar login, mostrar dashboard
    document.getElementById('login-screen').classList.add('d-none');
    document.getElementById('dashboard-screen').classList.remove('d-none');
    
    // Poner nombre
    document.getElementById('user-name').innerText = usuario.nombre;

    // Generar menú según rol
    const menu = document.getElementById('menu-lateral');
    menu.innerHTML = ''; // Limpiar

    let botones = [];

    if (usuario.rol === 'Directivo') {
        botones = [
            { txt: 'Gestión Estudiantes', func: 'verEstudiantes()' },
            { txt: 'Gestión Docentes', func: 'verDocentes()' },
            { txt: 'Planillas', func: 'verPlanillas()' }
        ];
    } else if (usuario.rol === 'Preceptor') {
        botones = [
            { txt: 'Tomar Asistencia', func: 'tomarAsistencia()' },
            { txt: 'Boletines', func: 'verBoletines()' }
        ];
    } else if (usuario.rol === 'Docente') {
        botones = [
            { txt: 'Cargar Notas', func: 'cargarNotas()' },
            { txt: 'Mi Asistencia', func: 'verMiAsistencia()' }
        ];
    }

    // Crear botones HTML
    botones.forEach(btn => {
        menu.innerHTML += `<button class="list-group-item list-group-item-action" onclick="${btn.func}">${btn.txt}</button>`;
    });
}

function logout() {
    location.reload();
}

// --- FUNCIONES DE LOS BOTONES (LAS LLENAREMOS EN LA PROXIMA FASE) ---
function verEstudiantes() { alert("Función de Directivo: Próximamente"); }
function verDocentes() { alert("Función de Directivo: Próximamente"); }
function tomarAsistencia() { alert("Función de Preceptor: Próximamente"); }
function cargarNotas() { alert("Función de Docente: Próximamente"); }